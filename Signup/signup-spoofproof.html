<script>
  // Minimal client wiring to /api/signup.php (no UI changes)
  function togglePassword(fieldId) {
    const input = document.getElementById(fieldId);
    input.type = input.type === "password" ? "text" : "password";
  }

  function toggleLogin() {
    const loginForm = document.getElementById("loginForm");
    loginForm.style.display = loginForm.style.display === "block" ? "none" : "block";
  }

  function showResetForm() {
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("resetForm").style.display = "block";
    const email = document.getElementById("loginEmail").value;
    if (email) document.getElementById("resetEmail").value = email;
  }

  document.getElementById("signupForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const firstName = document.getElementById("firstName").value.trim();
    const lastName  = document.getElementById("lastName").value.trim();
    const email     = document.getElementById("email").value.trim();
    const password  = document.getElementById("password").value;
    const confirm   = document.getElementById("confirmPassword").value;
    const agree     = document.getElementById("agree").checked;
    const errorDiv  = document.getElementById("formError");

    // client-side checks you already had
    if (!firstName || !lastName || !email || !password || !confirm || !agree) {
      errorDiv.textContent = "Please fill in all required fields correctly.";
      errorDiv.style.display = "block";
      return;
    }
    if (password !== confirm) {
      errorDiv.textContent = "Passwords do not match.";
      errorDiv.style.display = "block";
      return;
    }

    errorDiv.style.display = "none";

    // Build payload expected by signup.php
    const payload = {
      first_name: firstName,
      last_name:  lastName,
      email:      email,
      password:   password,
      consent:    agree
    };

    try {
      const res = await fetch("../api/signup.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
        credentials: "same-origin"
      });

      const data = await res.json().catch(() => ({}));

      if (!res.ok || !data.ok) {
        errorDiv.textContent = (data && data.error) ? data.error : "Signup failed. Please try again.";
        errorDiv.style.display = "block";
        return;
      }

      // Success: for this step, just confirm. (Next step = email verification flow)
      alert("Signup received. (Next step: email verification)");
    } catch (err) {
      errorDiv.textContent = "Network error. Please try again.";
      errorDiv.style.display = "block";
    }
  });
</script>
